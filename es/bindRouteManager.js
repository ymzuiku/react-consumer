"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,a=arguments.length;e<a;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};exports.__esModule=!0;var queryString=require("querystring-number"),_createRoute_1=require("./_createRoute");function bindRouteManager(t,r,o){function s(t,n){if(!t)return!0;for(var e=!0,a=0,i=u;a<i.length;a++){if(!(e=(0,i[a])(t,n,r.state)))break}return e}function a(e,a,i){s(e,a)&&r.update(function(t){t.paths.push(e);var n=__assign({},t.status[e],a);t.status[e]=n,"undefined"==typeof window||i||o||window.history.pushState(null,e,n?e+"?"+queryString.stringify(n):e)})}function i(t,e){var n=r.state,a="number"==typeof t?t:n.paths.length-1,i=n.paths[a-1],o=n.status[i];s(i,o)&&r.update(function(t){for(var n=0;n<t.paths.length-a;n++)e||window.history.back(),t.status[i]={},t.paths.pop()})}var n=_createRoute_1.createRoute(t),u=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var t=r.state.paths;if(window.location.pathname!==t[t.length-1]){var e=!1;if(t.forEach(function(t,n){t===window.location.pathname&&(e=!0)}),e)i(void 0,!0);else{var n=window.location.search;a(window.location.pathname,""===n?void 0:queryString.parse(n),!0)}}})}return{Route:n,dispatchRoute:{initRoute:function(t){if(r.update(function(t){t.paths=t.paths.slice(),t.status=__assign({},t.status)}),"undefined"!=typeof window){var n=window.location.pathname,e=window.location.search;"/"===n||n===t?a(t,e?queryString.parse(e):void 0):(a(t),a(n,e?queryString.parse(e):void 0))}},listen:function(t){u.push(t)},pop:i,push:a,replace:function(e,a){var t=r.state,i=e||t.paths[t.paths.length-1];s(i,a)&&r.update(function(t){var n=__assign({},t.status[e],a);t.status[e]=n,t.paths[t.paths.length-1]=i,"undefined"!=typeof window&&window.history.replaceState(null,i,n?e+"?"+queryString.stringify(n):i)})}}}}exports.bindRouteManager=bindRouteManager;