"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var e in n=arguments[i])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t}).apply(this,arguments)};exports.__esModule=!0;var queryString=require("querystring-number");exports.createHistory=function(o){function h(t,n){var i=t+n;if(f.has(i))return f.get(i);var r=t&&t.split("/"),e=n&&n.split("/");if(!e||!r)return f.set(i,!1),!1;var a=!0;return r.forEach(function(t,n){"*"!==t&&t!==e[n]&&(a=!1)}),f.set(i,a),a}function s(){if(0<window.location.hash.length){var t=window.location.hash.split("?"),n=t[0],i=t[1],r=void 0===i?"":i;return[n.replace(d,""),r]}return[window.location.pathname,window.location.search||""]}function u(t,n){for(var i=0,r=e;i<r.length;i++){(0,r[i])(t,n,o.state)}}function p(r,e,a){r!==o.state.paths[o.state.paths.length-1]&&(o.update(function(t){t.paths.push(r);var n=__assign({},t.history[r],e);if(t.history[r]=n,"undefined"!=typeof window&&!a&&!l){var i=queryString.stringify(n);window.history.pushState(null,""+d+r,""===i?""+d+r:""+d+r+"?"+i)}}),u(r,e))}function a(t,i){var n=o.state,r="number"==typeof t?t:n.paths.length-1,e=n.paths[r-1],a=n.history[e];o.update(function(t){for(var n=0;n<t.paths.length-r;n++)i||window.history.back(),t.history[e]={},t.paths.pop()}),u(e,a)}var f=new Map,c=new Map,d="",l=!1,e=[];if("undefined"!=typeof window){window.addEventListener("popstate",function(){var t=o.state.paths;if(s()[0]!==t[t.length-1]){var i=!1;if(t.forEach(function(t,n){t===s()[0]&&(i=!0)}),i)a(void 0,!0);else{var n=s(),r=n[0],e=n[1];p(r,""!==e?queryString.parse(e):void 0,!0)}}else u(s()[0],void 0)})}return{checkPathMatch:function(t){var n=o.state.paths,i=t+":"+n.join(",");if(c.has(i))return c.get(i);for(var r=!1,e=0,a=0;a<n.length;a++){h(t,n[a])&&(e=a,r=!0)}var s=[h(t,n[n.length-1]),r,e];return c.set(i,s),s},init:function(t,n,i){if(void 0===i&&(i="#"),l=n||!1,d=i,o.update(function(t){t.paths=[],t.history=__assign({},t.history)}),"undefined"!=typeof window){var r=s(),e=r[0],a=r[1];"/"===e||e===t?p(t,queryString.parse(a)):(p(t),p(e,queryString.parse(a)))}},listen:function(t){e.push(t)},pop:a,push:p,replace:function(r,e){var t=o.state,a=r||t.paths[t.paths.length-1];o.update(function(t){var n=__assign({},t.history[r],e);if(t.history[r]=n,t.paths[t.paths.length-1]=a,"undefined"!=typeof window){var i=queryString.stringify(n);window.history.replaceState(null,""+d+a,""===i?""+d+a:""+d+a+"?"+i)}}),u(a,e)}}};