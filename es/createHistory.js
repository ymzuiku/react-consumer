"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};exports.__esModule=!0;var queryString=require("querystring-number");exports.createHistory=function(o){function a(t,n){var e=t+n;if(p.has(e))return p.get(e);var i=t&&t.split("/"),r=n&&n.split("/");if(!r||!i)return p.set(e,!1),!1;var a=!0;return i.forEach(function(t,n){"*"!==t&&t!==r[n]&&(a=!1)}),p.set(e,a),a}function e(t){for(var n=o.getState().paths,e=!1,i=-1,r=n.length-1;0<=r;r--){if(a(t,n[r])){i=r,e=!0;break}}return{match:a(t,n[n.length-1]),stackMatch:e,lastPage:a(t,n[n.length-2]),index:i}}function s(){if(0<window.location.hash.length){var t=window.location.hash.split("?"),n=t[0],e=t[1],i=void 0===e?"":e;return[n.replace(c,""),i]}return[window.location.pathname,window.location.search||""]}function u(n,e){i.forEach(function(t){t(n,e,o.getState())})}function h(i,r,a){i!==o.getState().paths[o.getState().paths.length-1]&&(o.update(function(t){t.paths.push(i);var n=__assign({},t.history[i],r);if(t.history[i]=n,"undefined"!=typeof window&&!a&&!d){var e=queryString.stringify(n);window.history.pushState(null,""+c+i,""===e?""+c+i:""+c+i+"?"+e)}}),u(i,r))}function f(t,e){var i=o.getState(),r="number"==typeof t?t:i.paths.length-1,n=i.paths[r-1],a=i.history[n];o.update(function(t){for(var n=0;n<t.paths.length-r;n++)e||window.history.back(),t.history[i.paths[r]]={},t.paths.pop()}),u(n,a)}var p=new Map,c="",d=!1,i=new Set;if("undefined"!=typeof window){window.addEventListener("popstate",function(){var t=o.getState().paths;if(s()[0]!==t[t.length-1]){var e=!1;if(t.forEach(function(t,n){t===s()[0]&&(e=!0)}),e)f(void 0,!0);else{var n=s(),i=n[0],r=n[1];h(i,""!==r?queryString.parse(r):void 0,!0)}}else u(s()[0],void 0)})}return{checkUrlMatch:e,checkUrlsStaskTop:function(t,n){return e(t).index===n.map(function(t){return e(t).index}).slice().sort(function(t,n){return n-t})[0]},init:function(t,n,e){if(void 0===e&&(e="#"),d=n||!1,c=e,o.update(function(t){t.paths=[],t.history=__assign({},t.history)}),"undefined"!=typeof window){var i=s(),r=i[0],a=i[1];"/"===r||r===t?h(t,queryString.parse(a)):(h(t),setTimeout(function(){h(r,queryString.parse(a))}))}},listen:function(t){return i.add(t),function(){i.delete(t)}},pop:f,push:h,replace:function(i,r){var t=o.getState(),a=i||t.paths[t.paths.length-1];o.update(function(t){var n=__assign({},t.history[i],r);if(t.history[i]=n,t.paths[t.paths.length-1]=a,"undefined"!=typeof window){var e=queryString.stringify(n);window.history.replaceState(null,""+c+a,""===e?""+c+a:""+c+a+"?"+e)}}),u(a,r)}}};