!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("querystring-number"),require("react"),require("immer")):"function"==typeof define&&define.amd?define(["exports","querystring-number","react","immer"],e):e((t=t||self)["react-consumer"]={},t.queryString,t.React,t.produce)}(this,function(t,d,y,u){"use strict";u=u&&u.hasOwnProperty("default")?u.default:u;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function l(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var v=function(){return(v=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function n(a){function o(t,e){var n=t+e;if(c.has(n))return c.get(n);var r=t&&t.split("/"),i=e&&e.split("/");if(!i||!r)return c.set(n,!1),!1;var o=!0;return r.forEach(function(t,e){"*"!==t&&t!==i[e]&&(o=!1)}),c.set(n,o),o}function n(t){for(var e=a.getState().paths,n=!1,r=-1,i=e.length-1;0<=i;i--){if(o(t,e[i])){r=i,n=!0;break}}return{match:o(t,e[e.length-1]),stackMatch:n,lastPage:o(t,e[e.length-2]),index:r}}function s(){if(0<window.location.hash.length){var t=window.location.hash.split("?"),e=t[0],n=t[1],r=void 0===n?"":n;return[e.replace(f,""),r]}return[window.location.pathname,window.location.search||""]}function u(e,n){r.forEach(function(t){t(e,n,a.getState())})}function l(r,i,o){r!==a.getState().paths[a.getState().paths.length-1]&&(a.update(function(t){t.paths.push(r);var e=v(v({},t.history[r]),i);if(t.history[r]=e,"undefined"!=typeof window&&!o&&!h){var n=d.stringify(e);window.history.pushState(null,""+f+r,""===n?""+f+r:""+f+r+"?"+n)}}),u(r,i))}function p(t,n){var r=a.getState(),i="number"==typeof t?t:r.paths.length-1,e=r.paths[i-1],o=r.history[e];a.update(function(t){for(var e=0;e<t.paths.length-i;e++)n||window.history.back(),t.history[r.paths[i]]={},t.paths.pop()}),u(e,o)}var c=new Map,f="",h=!1,r=new Set;if("undefined"!=typeof window){window.addEventListener("popstate",function(){var t=a.getState().paths;if(s()[0]!==t[t.length-1]){var n=!1;if(t.forEach(function(t,e){t===s()[0]&&(n=!0)}),n)p(void 0,!0);else{var e=s(),r=e[0],i=e[1];l(r,""!==i?d.parse(i):void 0,!0)}}else u(s()[0],void 0)})}return{checkUrlMatch:n,checkUrlsStaskTop:function(t,e){return n(t).index===m(e.map(function(t){return n(t).index})).sort(function(t,e){return e-t})[0]},init:function(t,e,n){if(void 0===n&&(n="#"),h=e||!1,f=n,a.update(function(t){t.paths=[],t.history=v({},t.history)}),"undefined"!=typeof window){var r=s(),i=r[0],o=r[1];"/"===i||i===t?l(t,d.parse(o)):(l(t),setTimeout(function(){l(i,d.parse(o))}))}},listen:function(t){return r.add(t),function(){r.delete(t)}},pop:p,push:l,replace:function(r,i){var t=a.getState(),o=r||t.paths[t.paths.length-1];a.update(function(t){var e=v(v({},t.history[r]),i);if(t.history[r]=e,t.paths[t.paths.length-1]=o,"undefined"!=typeof window){var n=d.stringify(e);window.history.replaceState(null,""+f+o,""===n?""+f+o:""+f+o+"?"+n)}}),u(o,i)}}}var g="block",w="block",b=1,S=3,C=2,k="absolute",U="relative",E="auto",L="none";function i(h){var t,i;return l(e,i=y.Component),e.prototype.componentDidMount=function(){this.unListen=h.listen(this.onHistoryUpdate)},e.prototype.componentWillUnmount=function(){this.unListen&&this.unListen(),this.realChild=null,this.animeTimer=null},e.prototype.render=function(){var t=this.props.path,e=this.state,n=e.style;return e.isRenderChild?y.createElement("div",{about:t,style:v({width:"100%",height:"100%",overflow:"hidden",left:0,top:0},n)},this.realChild):null},(t=e).defaultProps={sync:"sync",keep:!0,animeTime:0},t;function e(t){var f=i.call(this,t)||this;f.animeTimer=null,f.realChild=null,f.state={isRenderChild:null,realChild:null,style:{display:w,position:k,zIndex:b}},f.unListen=null,f.onHistoryUpdate=function(){var t=f.props,e=t.path,n=t.delay,r=t.component,i=t.keep,o=t.leaveTime,a=f.state.isRenderChild,s=h.checkUrlMatch(e),u=s.match,l=s.stackMatch,p=s.lastPage;if(u)f.realChild||(void 0===n?(f.realChild=y.createElement(r,null),f.onHistoryUpdate()):r().then(function(t){f.realChild=y.createElement(t,null),f.onHistoryUpdate()})),f.setState({isRenderChild:!0,style:{pointerEvents:E,display:g,position:U,zIndex:S}});else{var c=i&&l;void 0!==a&&!0!==a||(p&&o&&0<o?f.setState({style:{pointerEvents:E,display:g,position:k,zIndex:g}},function(){setTimeout(function(){f.setState({isRenderChild:c,style:{pointerEvents:L,display:w,position:k,zIndex:b}})},o)}):f.setState({isRenderChild:c,style:{pointerEvents:L,display:w,position:k,zIndex:p?C:b}}))}};var e=f.props,n=e.delay,r=e.component;return void 0!==n&&0!==n&&setTimeout(function(){f.state.realChild||r()},n),f}}t.bindRouteManager=function(t){var e=n(t);return{Route:i(e),routeMap:e}},t.createHistory=n,t.createRoute=i,t.createStateManager=function(t){function e(t){return r.add(t),function(){r.delete(t)}}var n,r=new Set,i=t,s={listen:e,getState:function(){return i},subscribes:r,update:function(e){i=u(s.getState(),function(t){e(t)}),r.forEach(function(t){t(i)})}},o=(l(a,n=y.Component),a.prototype.componentWillUnmount=function(){this.unListen&&(this.unListen(),this.unListen=null),this.props.beforeUnmount&&this.props.beforeUnmount(this.lastData)},a.prototype.render=function(){var t;return(t=this.props).children.apply(t,this.lastData)},a);function a(t){var a=n.call(this,t)||this;return a.lastData=[],a.state={num:0},a.unListen=null,a.handleListen=function(t){for(var e=a.props,n=e.beforeUpdate,r=(0,e.subscribe)(s.getState()),i=!1,o=0;o<a.lastData.length;o++)if(a.lastData[o]!==r[o]){i=!0;break}a.lastData=m(r),i&&(void 0!==n&&n(r),a.setState(function(t){var e=t.num;return{num:900<e?1:e+1}}))},a.shouldComponentUpdate=function(t,e){if(e.num!==a.state.num)return!0;if(t.memo){for(var n=a.props.memo,r=!1,i=0;i<n.length;i++)if(t.memo[i]!==n[i]){r=!0;break}return r}return!1},a.props.subscribe&&(a.lastData=m(a.props.subscribe(s.getState())),a.unListen=e(a.handleListen)),a}return{store:s,Consumer:o}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=react-consumer.umd.js.map
