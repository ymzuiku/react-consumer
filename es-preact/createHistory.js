"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,n=0,r=arguments.length;n<r;n++)t+=arguments[n].length;var e=Array(t),i=0;for(n=0;n<r;n++)for(var a=arguments[n],s=0,o=a.length;s<o;s++,i++)e[i]=a[s];return e};exports.__esModule=!0;var queryString=require("querystring-number");exports.createHistory=function(s){function a(t,n){var r=t+n;if(p.has(r))return p.get(r);var e=t&&t.split("/"),i=n&&n.split("/");if(!i||!e)return p.set(r,!1),!1;var a=!0;return e.forEach(function(t,n){"*"!==t&&t!==i[n]&&(a=!1)}),p.set(r,a),a}function i(t){for(var n=s.getState().paths,r=!1,e=-1,i=n.length-1;0<=i;i--){if(a(t,n[i])){e=i,r=!0;break}}return{match:a(t,n[n.length-1]),stackMatch:r,lastPage:a(t,n[n.length-2]),index:e}}function o(){if(0<window.location.hash.length){var t=window.location.hash.split("?"),n=t[0],r=t[1],e=void 0===r?"":r;return[n.replace(c,""),e]}return[window.location.pathname,window.location.search||""]}function u(n,r){e.forEach(function(t){t(n,r,s.getState())})}function h(e,i,a){e!==s.getState().paths[s.getState().paths.length-1]&&(s.update(function(t){t.paths.push(e);var n=__assign(__assign({},t.history[e]),i);if(t.history[e]=n,"undefined"!=typeof window&&!a&&!d){var r=queryString.stringify(n);window.history.pushState(null,""+c+e,""===r?""+c+e:""+c+e+"?"+r)}}),u(e,i))}function f(t,r){var e=s.getState(),i="number"==typeof t?t:e.paths.length-1,n=e.paths[i-1],a=e.history[n];s.update(function(t){for(var n=0;n<t.paths.length-i;n++)r||window.history.back(),t.history[e.paths[i]]={},t.paths.pop()}),u(n,a)}var p=new Map,c="",d=!1,e=new Set;if("undefined"!=typeof window){window.addEventListener("popstate",function(){var t=s.getState().paths;if(o()[0]!==t[t.length-1]){var r=!1;if(t.forEach(function(t,n){t===o()[0]&&(r=!0)}),r)f(void 0,!0);else{var n=o(),e=n[0],i=n[1];h(e,""!==i?queryString.parse(i):void 0,!0)}}else u(o()[0],void 0)})}return{checkUrlMatch:i,checkUrlsStaskTop:function(t,n){var r=i(t).index,e=n.map(function(t){return i(t).index});return r===__spreadArrays(e).sort(function(t,n){return n-t})[0]},init:function(t,n,r){if(void 0===r&&(r="#"),d=n||!1,c=r,s.update(function(t){t.paths=[],t.history=__assign({},t.history)}),"undefined"!=typeof window){var e=o(),i=e[0],a=e[1];"/"===i||i===t?h(t,queryString.parse(a)):(h(t),setTimeout(function(){h(i,queryString.parse(a))}))}},listen:function(t){return e.add(t),function(){e.delete(t)}},pop:f,push:h,replace:function(e,i){var t=s.getState(),a=e||t.paths[t.paths.length-1];s.update(function(t){var n=__assign(__assign({},t.history[e]),i);if(t.history[e]=n,t.paths[t.paths.length-1]=a,"undefined"!=typeof window){var r=queryString.stringify(n);window.history.replaceState(null,""+c+a,""===r?""+c+a:""+c+a+"?"+r)}}),u(a,i)}}};